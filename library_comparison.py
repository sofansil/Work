"""
pykrx vs FinanceDataReader ë¹„êµ í…ŒìŠ¤íŠ¸
"""
import pandas as pd
import time
from datetime import datetime
import sys
import io

# Windows ì½˜ì†” UTF-8 ì¸ì½”ë”© ì„¤ì •
sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8')

print("=" * 80)
print("pykrx vs FinanceDataReader ë¹„êµ")
print("=" * 80)

# ============================================================================
# 1. pykrx í…ŒìŠ¤íŠ¸
# ============================================================================
print("\n[1] pykrx í…ŒìŠ¤íŠ¸")
print("-" * 80)

try:
    from pykrx import stock

    start_time = time.time()

    # KOSDAQ ì¢…ëª© ë¦¬ìŠ¤íŠ¸
    kosdaq_codes = stock.get_market_ticker_list(market="KOSDAQ")
    print(f"âœ“ KOSDAQ ì¢…ëª© ìˆ˜: {len(kosdaq_codes)}ê°œ")

    # ìƒìœ„ 5ê°œ ì¢…ëª© ì •ë³´
    print("\n[ìƒ˜í”Œ ë°ì´í„° - ìƒìœ„ 5ê°œ]")
    for i, code in enumerate(kosdaq_codes[:5], 1):
        name = stock.get_market_ticker_name(code)
        print(f"  {i}. {name} ({code})")

    # íŠ¹ì • ì¢…ëª©ì˜ OHLCV ë°ì´í„° (ìµœê·¼ 5ì¼)
    print("\n[OHLCV ë°ì´í„° - ì²« ë²ˆì§¸ ì¢…ëª©]")
    test_code = kosdaq_codes[0]
    today = datetime.today().strftime('%Y%m%d')
    ohlcv = stock.get_market_ohlcv("20241201", today, test_code)
    print(ohlcv.head())

    # ì‹œê°€ì´ì•¡ ë°ì´í„°
    print("\n[ì‹œê°€ì´ì•¡ ë°ì´í„° - ì²« ë²ˆì§¸ ì¢…ëª©]")
    cap = stock.get_market_cap(today, market="KOSDAQ")
    print(cap.head())

    elapsed = time.time() - start_time
    print(f"\nâ± ì†Œìš” ì‹œê°„: {elapsed:.2f}ì´ˆ")

    pykrx_success = True

except ImportError:
    print("âŒ pykrxê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
    print("   ì„¤ì¹˜: pip install pykrx")
    pykrx_success = False
except Exception as e:
    print(f"âŒ pykrx ì˜¤ë¥˜: {e}")
    pykrx_success = False

# ============================================================================
# 2. FinanceDataReader í…ŒìŠ¤íŠ¸
# ============================================================================
print("\n" + "=" * 80)
print("[2] FinanceDataReader í…ŒìŠ¤íŠ¸")
print("-" * 80)

try:
    import FinanceDataReader as fdr

    start_time = time.time()

    # KOSDAQ ì¢…ëª© ë¦¬ìŠ¤íŠ¸
    kosdaq = fdr.StockListing('KOSDAQ')
    print(f"âœ“ KOSDAQ ì¢…ëª© ìˆ˜: {len(kosdaq)}ê°œ")

    # ë°ì´í„°í”„ë ˆì„ êµ¬ì¡°
    print("\n[ë°ì´í„°í”„ë ˆì„ ì»¬ëŸ¼]")
    print(kosdaq.columns.tolist())

    # ìƒìœ„ 5ê°œ ì¢…ëª© ì •ë³´
    print("\n[ìƒ˜í”Œ ë°ì´í„° - ìƒìœ„ 5ê°œ]")
    print(kosdaq.head())

    # íŠ¹ì • ì¢…ëª©ì˜ OHLCV ë°ì´í„° (ìµœê·¼ 5ì¼)
    print("\n[OHLCV ë°ì´í„° - ì²« ë²ˆì§¸ ì¢…ëª©]")
    test_code = kosdaq.iloc[0]['Code']
    ohlcv = fdr.DataReader(test_code, '2024-12-01')
    print(ohlcv.tail())

    elapsed = time.time() - start_time
    print(f"\nâ± ì†Œìš” ì‹œê°„: {elapsed:.2f}ì´ˆ")

    fdr_success = True

except ImportError:
    print("âŒ FinanceDataReaderê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
    print("   ì„¤ì¹˜: pip install finance-datareader")
    fdr_success = False
except Exception as e:
    print(f"âŒ FinanceDataReader ì˜¤ë¥˜: {e}")
    fdr_success = False

# ============================================================================
# 3. ë¹„êµ ìš”ì•½
# ============================================================================
print("\n" + "=" * 80)
print("[3] ë¹„êµ ìš”ì•½")
print("=" * 80)

comparison = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      í•­ëª©           â”‚      pykrx          â”‚ FinanceDataReader   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì„¤ì¹˜ í¬ê¸°           â”‚      ì‘ìŒ           â”‚       ì‘ìŒ          â”‚
â”‚ í•œêµ­ ì£¼ì‹ ì§€ì›      â”‚    â˜…â˜…â˜…â˜…â˜…          â”‚     â˜…â˜…â˜…â˜…â˜…         â”‚
â”‚ í•´ì™¸ ì£¼ì‹ ì§€ì›      â”‚      âœ—              â”‚     â˜…â˜…â˜…â˜…â˜…         â”‚
â”‚ ë°ì´í„° ìƒì„¸ë„       â”‚    â˜…â˜…â˜…â˜…â˜…          â”‚     â˜…â˜…â˜…â˜…          â”‚
â”‚ ì‚¬ìš© í¸ì˜ì„±         â”‚    â˜…â˜…â˜…â˜…           â”‚     â˜…â˜…â˜…â˜…â˜…         â”‚
â”‚ ì—…ë°ì´íŠ¸ ë¹ˆë„       â”‚    â˜…â˜…â˜…â˜…â˜…          â”‚     â˜…â˜…â˜…â˜…          â”‚
â”‚ ë°ì´í„° ì†ŒìŠ¤         â”‚  KRX (ê³µì‹)         â”‚  ë„¤ì´ë²„/KRX ë“±      â”‚
â”‚ ì‹œê°€ì´ì•¡ ì •ë³´       â”‚      â—‹              â”‚       â—‹             â”‚
â”‚ ì™¸êµ­ì¸/ê¸°ê´€ ë³´ìœ     â”‚      â—‹              â”‚       âœ—             â”‚
â”‚ ì¬ë¬´ì œí‘œ            â”‚      â—‹              â”‚       âœ—             â”‚
â”‚ ETF ì •ë³´            â”‚      â—‹              â”‚       â—‹             â”‚
â”‚ í™˜ìœ¨/ì›ìì¬         â”‚      âœ—              â”‚       â—‹             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ì¶”ì²œ ìš©ë„]
â€¢ pykrx:
  - í•œêµ­ ì£¼ì‹ ì „ë¬¸ ë¶„ì„
  - ì™¸êµ­ì¸/ê¸°ê´€ ë§¤ë§¤ ë™í–¥ ë¶„ì„
  - ì¬ë¬´ì œí‘œ ë¶„ì„
  - KRX ê³µì‹ ë°ì´í„° í•„ìš” ì‹œ

â€¢ FinanceDataReader:
  - í•œêµ­ + í•´ì™¸ ì£¼ì‹ ë™ì‹œ ë¶„ì„
  - ë¯¸êµ­ ì£¼ì‹(S&P500 ë“±) í¬í•¨
  - í™˜ìœ¨, ì•”í˜¸í™”í ë“± ë‹¤ì–‘í•œ ë°ì´í„°
  - ê°„ë‹¨í•œ ë°±í…ŒìŠ¤íŒ…

[ì†ë„ ë¹„êµ]
â€¢ ì¢…ëª© ë¦¬ìŠ¤íŠ¸: ë¹„ìŠ·í•¨ (ë‘˜ ë‹¤ 1~2ì´ˆ)
â€¢ OHLCV ì¡°íšŒ: pykrxê°€ ì•½ê°„ ë¹ ë¦„
â€¢ ëŒ€ëŸ‰ ë°ì´í„°: pykrxê°€ ë” ì•ˆì •ì 
"""

print(comparison)

# ============================================================================
# 4. ì‹¤ì „ ì¶”ì²œ
# ============================================================================
print("\n" + "=" * 80)
print("[4] ì‹¤ì „ ì¶”ì²œ")
print("=" * 80)

recommendation = """
ğŸ¯ ê·€í•˜ì˜ ê²½ìš° (KOSDAQ ì¢…ëª© ìŠ¤í¬ë¦¬ë‹):

ã€ì¶”ì²œ: pykrxã€‘

ì´ìœ :
1. âœ“ í•œêµ­ ì£¼ì‹ë§Œ ì‚¬ìš© â†’ í•´ì™¸ ì£¼ì‹ ê¸°ëŠ¥ ë¶ˆí•„ìš”
2. âœ“ KRX ê³µì‹ ë°ì´í„° â†’ ë” ì •í™•í•˜ê³  ì•ˆì •ì 
3. âœ“ ì™¸êµ­ì¸/ê¸°ê´€ ë§¤ë§¤ ë°ì´í„° â†’ ì¶”ê°€ ë¶„ì„ ê°€ëŠ¥
4. âœ“ ì‹œê°€ì´ì•¡, ê±°ë˜ëŒ€ê¸ˆ ë“± ìƒì„¸ ì •ë³´
5. âœ“ í™œë°œí•œ ì—…ë°ì´íŠ¸ (2024ë…„ê¹Œì§€ ì§€ì†)

í•˜ì§€ë§Œ FinanceDataReaderë„ ì„¤ì¹˜ ê¶Œì¥:
- ë‚˜ì¤‘ì— S&P500 ê°™ì€ í•´ì™¸ ì§€ìˆ˜ ë¶„ì„í•  ë•Œ ìœ ìš©
- ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë‘ ê°€ë³ê³  ì¶©ëŒ ì—†ìŒ

ì„¤ì¹˜ ëª…ë ¹:
pip install pykrx finance-datareader
"""

print(recommendation)

print("\n" + "=" * 80)
print("í…ŒìŠ¤íŠ¸ ì™„ë£Œ")
print("=" * 80)
